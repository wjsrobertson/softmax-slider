<html>
<head>
    <script src="libs/Chart.bundle.js"></script>
    <script src="libs/jquery-3.2.1.min.js"></script>
    <script src="libs/bootstrap/js/bootstrap.js"></script>
    <script src="libs/slider/js/bootstrap-slider.js"></script>
    <script src="libs/lodash.min.js"></script>
    <script src="libs/html5shiv.min.js"></script>
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap-theme.css">
    <link rel="stylesheet" href="libs/slider/css/slider.css">

    <style>
        .template {
            display:none;
        }
    </style>
</head>
<body>

<div class="page-header">
    <h1>Panels</h1>
</div>
<div class="row">
    <div class="col-sm-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2 class="panel-title">Category Values</h2>
            </div>
            <div class="panel-body">


                <div class="form-group">
                    <button id="add-category" type="button" class="btn btn-default btn-md">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <label for="add-category">
                        <small>Add new category</small>
                    </label>
                </div>

                <legend>Categories</legend>

                <div id="category-control-template" class="template">
                    <div class="form-group" use="category-slider">
                        <div>
                            <button title="remove" use="remove" type="button" class="btn btn-default btn-sm span1">
                                <span class="glyphicon glyphicon-remove"></span>
                            </button>

                            <input use="slider" type="text" value="" data-slider-min="0" data-slider-max="100" data-slider-step="1"
                                   data-slider-value="0" data-slider-selection="after" data-slider-tooltip="hide">
                        </div>

                    </div>
                </div>

                <div id="category-controls" class="form-group">
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-4">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Softmax Output</h3>
            </div>
            <div class="panel-body">
                <canvas id="chart-container" width="300" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<script>

    var smax = {};

    smax.softmax = function(input) {
        _.map(input, function(value) {
            return value / 2;
        })
    };

    smax.data = {
        maxValue: 100,
        raw: [],
        softmax: []
    };

    smax.CategorySource = (function () {
        var nameIndex = -1;

        var colourIndex = -1;

        var names = ['Abe', 'Ada', 'Addy', 'Aggy', 'Al', 'Alex', 'Allie', 'Andy', 'Ann', 'Annie', 'Ara', 'Archie', 'Arly', 'Art', 'Babs',
            'Barbie', 'Barney', 'Bart', 'Bea', 'Becca', 'Becky', 'Bella', 'Belle', 'Ben', 'Benjy', 'Bennie', 'Berny', 'Bert', 'Bess',
            'Beth', 'Betsy', 'Betty', 'Bill', 'Billy', 'Birdie', 'Birtie', 'Bob', 'Bobbie', 'Bobby', 'Brad', 'Brody', 'By', 'Cal', 'Cammie',
            'Carl', 'Carol', 'Cassie', 'Cathy', 'Charlie', 'Chet', 'Chris', 'Chuck', 'Cindy', 'Clara', 'Cliff', 'Connie', 'Crissy',
            'Curt', 'Cy', 'Dan', 'Danny', 'Dave', 'Davey', 'Deb', 'Debbie', 'Dee', 'Del', 'Della', 'Dennie', 'Dennis', 'Denny', 'Dick',
            'Dolly', 'Dom', 'Don', 'Donnie', 'Donny', 'Dora', 'Dot', 'Dottie', 'Dotty', 'Drew', 'Ed', 'Eddie', 'Eddy', 'Elaine', 'Ella',
            'Ellen', 'Emily', 'Emma', 'Eve', 'Fay', 'Flo', 'Flora', 'Fran', 'Frank', 'Frankie', 'Frannie', 'Franny', 'Fred', 'Freda',
            'Freddie', 'Freddy', 'Gabby', 'Gabe', 'Gail', 'Gene', 'Geoff', 'George', 'Gerrie', 'Gerry', 'Gertie', 'Gil', 'Gina',
            'Gretta', 'Gus', 'Gwen', 'Hal', 'Hank', 'Hannah', 'Harry', 'Hattie', 'Henny', 'Herb', 'Hetty', 'Hipsie', 'Hugh', 'Iggy', 'Issy',
            'Izzy', 'Jake', 'Jamie', 'Jan', 'Jay', 'Jean', 'Jeb', 'Jeff', 'Jennie', 'Jenny', 'Jerry', 'Jessie', 'Jim', 'Jimmie', 'Jimmy', 'Jo',
            'Jody', 'Joe', 'Joey', 'John', 'Jon', 'Josey', 'Josh', 'Joy', 'Judy', 'Julie', 'Kate', 'Kathy', 'Katy', 'Kay', 'Kaye', 'Ken',
            'Kenny', 'Kim', 'Larry', 'Lee', 'Lena', 'Lenny', 'Leo', 'Leon', 'Les', 'Libby', 'Lilly', 'Linda', 'Lisa', 'Liz', 'Lizzie', 'Lois',
            'Lorie', 'Lou', 'Lucy', 'Luke', 'Lynn', 'Maddy', 'Madge', 'Madie', 'Maggie', 'Maggy', 'Mandy', 'Marge', 'Margie', 'Margy', 'Mark',
            'Marty', 'Marv', 'Matt', 'Maud', 'Mel', 'Merv', 'Mick', 'Mickey', 'Mike', 'Mindy', 'Minnie', 'Missy', 'Mitch', 'Monty', 'Nat',
            'Nate', 'Nathan', 'Neil', 'Newt', 'Nick', 'Nickie', 'Nora', 'Obie', 'Ollie', 'Ozzy', 'Pat', 'Patsy', 'Patty', 'Peggy', 'Penny',
            'Pete', 'Phil', 'Polly', 'Prissy', 'Prudy', 'Randy', 'Ray', 'Reba', 'Reggie', 'Rena', 'Rich', 'Richie', 'Rick', 'Ricky', 'Rob',
            'Robby', 'Rod', 'Ron', 'Ronnie', 'Ronny', 'Rose', 'Roz', 'Rube', 'Rudy', 'Russ', 'Rusty', 'Sal', 'Sam', 'Sammy', 'Sandra', 'Sandy',
            'Scott', 'Scotty', 'Shelly', 'Sherry', 'Sly', 'Stella', 'Steph', 'Steve', 'Sue', 'Sully', 'Susie', 'Tabby', 'Ted', 'Teddy', 'Terry',
            'Tess', 'Tessa', 'Tessie', 'Thad', 'Theo', 'Thom', 'Tilla', 'Tim', 'Timmy', 'Tina', 'Tish', 'Tisha', 'Toby', 'Tom', 'Tommy', 'Tony',
            'Tori', 'Torie', 'Torri', 'Torrie', 'Tory', 'Trisha', 'Trixie', 'Trudy', 'Val', 'Van', 'Vanna', 'Vic', 'Vicki', 'Vickie', 'Vicky',
            'Vin', 'Vince', 'Vinnie', 'Waldo', 'Wendy', 'Wilber', 'Will', 'Willie', 'Wilma', 'Winnie', 'Winny', 'Woody', 'Zach'];

        var backgroundColours = ['rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)'
        ];

        var borderColours = [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
        ];

        function nextName() {
            nameIndex = Math.floor(Math.random() * names.length);
            return names[nameIndex]
        }

        function nextColour() {
            colourIndex = (colourIndex + 1) % backgroundColours.length;
            return {background: backgroundColours[colourIndex], border: borderColours[colourIndex]};
        }

        return {
            newCategory: function () {
                var colour = nextColour();
                var name = nextName();

                return {
                    background: colour.background,
                    border: colour.border,
                    name: name
                }
            }
        }
    })();

    smax.Chart = (function (chartContainerId) {
        Chart.defaults.global.legend.display = false;

        var chartContainer = $('#' + chartContainerId);

        var chart = new Chart(chartContainer, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    data: [],
                    backgroundColor: [],
                    borderColor: [],
                    borderWidth: 1
                }/*,{
                    data: [],
                    backgroundColor: [],
                    borderColor: [],
                    borderWidth: 1
                }*/]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });

        function updateCategoryValue(index, value) {
            smax.data.raw[index] = value;
            chart.config.data.datasets[0].data[index] = value;
        }

        return {
            newCategory: function(category) {
                var value = Math.floor(Math.random() * smax.data.maxValue);
                var index = chart.config.data.datasets[0].data.length;
                getCategorySlider(index).slider('setValue', value);
                smax.data.raw.push(value);

                chart.config.data.labels.push(category.name);
                chart.config.data.datasets[0].data.push(value);
                chart.config.data.datasets[0].backgroundColor.push(category.background);
                chart.config.data.datasets[0].borderColor.push(category.border);
            },
            removeCategory: function(index) {
                removeCategorySlider(index);

                smax.data.raw.splice(index, 1);
                chart.config.data.labels.splice(index, 1);
                chart.config.data.datasets[0].data.splice(index, 1);
                chart.config.data.datasets[0].backgroundColor.splice(index, 1);
                chart.config.data.datasets[0].borderColor.splice(index, 1);
            },
            updateCategoryValues: function() {
                _.forEach(smax.data.raw, function(value, index) {
                    //getCategorySlider(index).slider('setValue', value);
                    updateCategoryValue(index, value)
                });
            },
            updateChart: function() {
                chart.update();
            }
        };
    })("chart-container");

    function getSliderValues() {
        var sliderControl = $('#category-controls').children();

        var sliders = _.map(sliderControl, function(container){
            return $(container).find("input[use='slider']");
        });

        var values = _.map(sliders, function(slider) {
            return slider.slider('getValue')[0].value;
        });

        return values;
    }

    function reclaculate() {
        smax.data.softmax = _.map(smax.data.raw, function(value) {
            return value / 2;
        });
    }

    function getCategorySlider(index) {
        return $($('#category-controls').children()[index]).find("input[use='slider']");
    }

    function removeCategorySlider(index) {
        $('#category-controls').children()[index].remove();
    }

    smax.PageBinder = (function(categoryControlTemplateId, categoryControlsId, addCategoryButtonId) {
        var template = $('#' + categoryControlTemplateId).children().first();

        $('#' + addCategoryButtonId).click(function () {
            addNewCategory();
        });

        function addNewCategory() {
            var control = template.clone().appendTo('#' + categoryControlsId);

            control.find("input[use='slider']").slider().on('slide', function (ev) {
                var index = $(ev.target).parent().parent().parent().index();
                smax.data.raw[index] = ev.value;
                reclaculate();
                smax.Chart.updateCategoryValues();
                smax.Chart.updateChart();
            });
            control.find("button[use='remove']").click(function (ev) {
                var index = $(ev.target).parent().parent().parent().index();
                smax.Chart.removeCategory(index);
                smax.Chart.updateChart();
            });

            var newCategory = smax.CategorySource.newCategory();
            smax.Chart.newCategory(newCategory);
            smax.Chart.updateChart();
        }
    })('category-control-template', 'category-controls', 'add-category');




</script>

</body>
</html>